

test_that("ema works correctly with theta=0 and same consequent dates", {

  date <- c(15295.3550810185, 15295.3550810185, 15295.3551851852,
              15295.3552314815, 15295.3552777778, 15295.3580902778, 15295.3581365741,
              15295.3582986111, 15295.3583680556, 15295.3584722222, 15295.3585185185,
              15295.3656018519, 15295.3800462963, 15295.3992476852, 15295.4045138889,
              15295.4118171296, 15295.4141550926, 15295.4168981481, 15295.4232523148,
              15295.4245023148, 15295.4281018519, 15295.4316435185)
    x <- c(2.19253, 2.18509145044662, 2.19996, 2.1851, 2.19996, 2.1851,
           2.19996, 2.1851, 2.19996, 2.1851000878661, 2.2, 2.21, 2.18031850460013,
           2.1978075, 2.187, 2.21208, 2.21208, 2.21208, 2.23109, 2.2311,
           2.07891998242106, 2.24809640454591)
    weight <- c(0.0940188,
                -0.4702, 0.44052498, -0.1, 0.09350154, -0.1, 0.0940188, -0.1,
                0.09350154, -20.28694715, 19.07266652, 1, -69.78409791, 104,
                -0.1, 0.06188, 9.07922239, 13.57, 4, 93, 1.11754181, 0.02333085)
    expect_true(all(is.finite(ema(x, date, n = 0))))
    expect_true(all(is.finite(ema(x, date, n = 0, linear = T))))
    expect_true(all(is.finite(ema(x, date, n = 0, cum = T))))
    expect_equal(ema(x, date, n = 0), x)
    expect_equal(ema(x, date, n = 0, linear = T), x)
    expect_equal(wema(x, weight, date, n = 0, cum = T), x)
    expect_equal(wema(x, weight, date, n = 0, linear = T), x)

})

## x <- c(NA, 1:10)
## ema(x, 0:10)
## ema(rep.int(x, 2), 0:22)

## test_that("efilter works correctly", {
##     d <- 1:5
##     x <- (1:5)*10
##     expect_equal(efilter(x, d, 1),
##                  c(12.8565871583233, 20.9256117580224, 30,
##                    39.0743882419776, 47.1434128416767))
## })
